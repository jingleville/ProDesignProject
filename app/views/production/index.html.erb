<h1 class="text-2xl font-bold mb-6">Картина производства</h1>

<% if @grouped_tasks.empty? %>
  <p class="text-gray-500">Нет активных задач в производстве.</p>
<% else %>
  <% @grouped_tasks.each do |assignee_name, tasks| %>
    <div class="mb-8">
      <h2 class="text-lg font-semibold mb-3 text-gray-800"><%= assignee_name %></h2>
      <div class="bg-white shadow rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Задача</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Проект</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Статус</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Срок</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% tasks.each do |task| %>
              <tr class="hover:bg-gray-50 <%= 'bg-red-50' if task.overdue? %>">
                <td class="px-6 py-4">
                  <%= link_to task.title, project_task_path(task.project, task), class: "text-indigo-600 hover:text-indigo-900 font-medium" %>
                  <% if task.overdue? %>
                    <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">Просрочена</span>
                  <% end %>
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">
                  <%= link_to task.project.name, project_path(task.project), class: "hover:text-indigo-600" %>
                </td>
                <td class="px-6 py-4">
                  <%= render partial: "tasks/status_badge", locals: { status: task.status } %>
                </td>
                <td class="px-6 py-4 text-sm text-gray-500"><%= task.due_date&.strftime("%d.%m.%Y") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
<% end %>
